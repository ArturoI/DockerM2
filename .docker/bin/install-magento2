#!/usr/bin/env bash
if [ -f ~/.composer/auth.json ]
  then
    cd /var/www/html;
    composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition .;
    chmod u+w -R var vendor pub/static pub/media app/etc;
    chmod u+x bin/magento;
    ./bin/magento setup:install --base-url=http://localhost/ \
        --db-host=db
        --db-name=magento
        --db-user=magento
        --db-password=magento \
        --admin-firstname=Magento
        --admin-lastname=Commerce
        --admin-email=user@example.com \
        --admin-user=admin
        --admin-password=admin123
        --language=en_US
        --magento-init-params="MAGE_MODE=production" \
        --currency=USD
        --timezone=America/Chicago
        --use-rewrites=1
        --use-sample-data
        --backend-frontname=admin \
        --session-save-redis-host='redis-session'
        --session-save-redis-port='6379'
        --session-save-redis-password=''
        --session-save-redis-timeout='2.5'
        --session-save-redis-persistent_identifier=''
        --session-save-redis-database='2'
        --session-save-redis-compression_threshold='2048'
        --session-save-redis-compression_library='gzip'
        --session-save-redis-log_level='1'
        --session-save-redis-max_concurrency='6'
        --session-save-redis-break_after_frontend='5'
        --session-save-redis-break_after_adminhtml='30'
        --session-save-redis-first_lifetime='600'
        --session-save-redis-bot_first_lifetime='60'
        --session-save-redis-bot_lifetime='7200'
        --session-save-redis-disable_locking='0'
        --session-save-redis-min_lifetime='60'
        --session-save-redis-max_lifetime='2592000'
        --cache-backend-redis-server='redis'
        --cache-backend-redis-db='0'
        --cache-backend-redis-port='6379'
        --page-cache-redis-server='redis'
        --page-cache-redis-port='6379'
        --page-cache-redis-db='1'
        --page-cache-redis-compress-data='1'
    composer dump-autoload -o
else
    echo "Please create your file ~/.composer/auth.json"
fi
